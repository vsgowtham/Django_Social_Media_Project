{% extends 'base.html' %}

{% block content %}
  {% if not request.user.is_authenticated  %}
    <h1>Sorry ! you need to be logged in </h1>
  {% else %}
  <form method="POST" action={% url 'add_post' %}>
    {% csrf_token %}
  <div class="form-floating">
    <textarea class="form-control" placeholder="Leave a caption here" id="floatingTextarea2" style="height: 100px" name="caption"></textarea>
    <label for="floatingTextarea2">Add your caption</label>
    <button type="submit" class="btn btn-primary">Post</button>
  </div>
  </form>
  <h1>Posts</h1>
  {% for post in post_list %}
  <div class="card" style="width: 18rem;">
    <div class="card-body">
      <p class="card-text">{{post.caption}}</p>
      <br>
      <blockquote class="blockquote mb-0">
        <footer class="blockquote-footer">{{post.user.username}}</footer>
      </blockquote>
      <br>
      {% if request.user.id != post.user.id %}
      <form action="{% url 'like_post' post.id %}" method="GET">
        {% if post.id in  already_liked_post_ids_of_current_user  %}
          Already Liked !
        {% else %}
          <button type="submit" class="btn btn-primary">Like</button>
        {% endif %}
      </form>
      {% endif %}
      Nof of Likes : {{post.like_post.count}}
      Liked by 
      {% for like_post in post.like_post.all %}
        <button type="button" class="btn btn-primary">{{like_post.user.username}}</button>
      {% endfor %}

    </div>
  </div>
  {% endfor %}
  {% endif %}
{% endblock %}